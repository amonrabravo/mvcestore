@model DashboardDataViewModel
@{
    ViewData["Title"] = "Hoşgeldiniz";
}

<div class="row">
    <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
            <div class="inner">
                <h1>
                    @Model.NewOrders.Count().ToString("n0")
                </h1>

                <p>Yeni Siparişler</p>
            </div>
            <div class="icon">
                <i class="fa fa-shopping-cart"></i>
            </div>
            <a asp-controller="Orders" asp-action="Index" class="small-box-footer">daha <i class="fas fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
            <div class="inner">
                <h1>
                    @Model.SalesTotal.ToString("n2")
                </h1>

                <p>Toplam Satış</p>
            </div>
            <div class="icon">
                <i class="fa fa-chart-bar"></i>
            </div>
            <a asp-controller="Orders" asp-action="Index" class="small-box-footer">daha <i class="fas fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
            <div class="inner">
                <h1>
                    @Model.SalesThisMonth.ToString("n2")
                </h1>

                <p>Aylık Satış</p>
            </div>
            <div class="icon">
                <i class="fa fa-chart-bar"></i>
            </div>
            <a asp-controller="Orders" asp-action="Index" class="small-box-footer">daha <i class="fas fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
            <div class="inner">
                <h1>
                    @Model.Users.ToString("n0")
                </h1>

                <p>Üyeler</p>
            </div>
            <div class="icon">
                <i class="fa fa-user-plus"></i>
            </div>
            <a asp-controller="Users" asp-action="Index" class="small-box-footer">daha <i class="fas fa-arrow-circle-right"></i></a>
        </div>
    </div>
</div>

<div class="row">
    <section class="col-12 col-lg-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-chart-area mr-1"></i>
                    @DateTime.Today.Year Aylık Satış
                </h3>
            </div>
            <div class="card-body p-0">
                <canvas id="revenue-chart-canvas" height="400" style="height: 400px; display: block; width: 100%"></canvas>
            </div>
        </div>
    </section>
    <section class="col-12 col-lg-4">
        <div class="card card-warning">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-chart-area mr-1"></i>
                    @DateTime.Today.Year Aylık Satış
                </h3>
            </div>
            <div class="card-body">
                <table class="table table-striped table-borderless table-sm">
                    <thead>
                        <tr>
                            <th>Ay</th>
                            <th class="text-right">Toplam Satış (₺)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sales in Model.SalesData)
                        {
                            <tr>
                                <td>
                                    @sales.MonthName
                                </td>
                                <td class="text-right text-monospace">
                                    @sales.Value.ToString("n2")
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

            </div>
        </div>
    </section>
</div>
<div class="row">
    <section class="col-12 col-lg-4">
        <div class="card card-danger mb-2">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-shopping-cart mr-1"></i>
                    Yeni Siparişler
                </h3>
            </div>
            <div class="card-body p-0">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Üye Adı</th>
                            <th>Üye E-Posta</th>
                            <th class="text-right">Toplam Tutar (₺)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model.NewOrders)
                        {
                            <tr>
                                <td>
                                    <i class="fa fa-user mr-2"></i> @order.User.Name
                                </td>
                                <td>
                                    <a href="mailto:@order.User.UserName">
                                        @order.User.UserName
                                    </a>
                                </td>
                                <td class="text-right text-monospace">
                                    @order.GrandTotal.ToString("n2")
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section class="col-12 col-lg-4">
        <div class="card card-success mb-2">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-gifts mr-1"></i>
                    Çok Satan Ürünler
                </h3>
            </div>
            <div class="card-body p-0">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Foto</th>
                            <th>Ürün</th>
                            <th class="text-right">Adet</th>
                            <th class="text-right">Tutar (₺)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var productSale in Model.MostProductSales)
                        {
                            <tr>
                                <td style="width: 80px">
                                    <img src="@productSale.Product.Picture" class="img-thumbnail" />
                                </td>
                                <td>
                                    <a asp-controller="Products" asp-action="Edit" asp-route-id="@productSale.Product.Id">
                                        @productSale.Product.Name
                                    </a>
                                </td>
                                <td class="text-right text-monospace">
                                    @productSale.Quantity.ToString("n0")
                                </td>
                                <td class="text-right text-monospace">
                                    @productSale.Sales.ToString("n2")
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <section class="col-12 col-lg-4">
        <div class="card card-info mb-2">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-gifts mr-1"></i>
                    En Çok Görüntülenen Ürünler
                </h3>
            </div>
            <div class="card-body p-0">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Foto</th>
                            <th>Ürün</th>
                            <th class="text-right">Adet</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var productReview in Model.MostProductReviews)
                        {
                            <tr>
                                <td style="width: 80px">
                                    <img src="@productReview.Picture" class="img-thumbnail" />
                                </td>
                                <td>
                                    <div class="text-truncate" style="max-width: 300px;">
                                        <a asp-controller="Products" asp-action="Edit" asp-route-id="@productReview.Id">
                                            @productReview.Name
                                        </a>
                                    </div>
                                </td>
                                <td class="text-right text-monospace">
                                    @productReview.Reviews.ToString("n0")
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </section>
</div>

@section Scripts {
    <link href="~/js/admin/chart.js/Chart.min.css" rel="stylesheet" />
    <script src="~/js/admin/chart.js/Chart.bundle.min.js"></script>
    <script>
        $(() => {

        const salesChartData = {
            labels: [@Html.Raw(string.Join(",", Model.SalesData.Select(p=>$"'{p.MonthName}'")))],
            datasets: [
                {
                    label: 'Aylık Satış',
                    data: [@Html.Raw(string.Join(",", Model.SalesData.Select(p=>p.InvariantValue)))],
                    borderColor: '#FF1133F0',
                    backgroundColor: '#FF113390',
                    fill: true,
                    smooth: true
                }
            ]
        };

        const salesChartConfig = {
            type: 'line',
            data: salesChartData
        };
        var salesChartCanvas = document.getElementById('revenue-chart-canvas').getContext('2d')
        var salesChart = new Chart(salesChartCanvas, salesChartConfig)

    });
    </script>
}